<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painon seuranta (Premium)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root { 
    --bg: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
    --txt: #fff; 
    --accent: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --accent-hover: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    --box: rgba(255, 255, 255, 0.08);
    --box-hover: rgba(255, 255, 255, 0.12);
    --border: rgba(255, 255, 255, 0.18);
    --shadow: rgba(0, 0, 0, 0.4);
  }

  * {
    box-sizing: border-box;
  }

  body {
    background: #0f0c29;
    background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
    color: var(--txt);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    padding: 20px;
    max-width: 580px;
    margin: 0 auto;
    min-height: 100vh;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 50%);
    animation: rotate 20s linear infinite;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  h1 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: 30px;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -1px;
    position: relative;
    z-index: 1;
    text-shadow: 0 0 40px rgba(102, 126, 234, 0.3);
  }

  form, #goalBox, #chartBox {
    background: var(--box);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 24px;
    border-radius: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
    box-shadow: 0 8px 32px var(--shadow);
    position: relative;
    z-index: 1;
    transition: all 0.3s ease;
  }

  form:hover, #goalBox:hover, #chartBox:hover {
    background: var(--box-hover);
    transform: translateY(-2px);
    box-shadow: 0 12px 40px var(--shadow);
  }

  label {
    font-size: 0.85rem;
    margin-bottom: 8px;
    display: block;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255, 255, 255, 0.8);
  }

  input, button {
    width: 100%;
    padding: 14px 18px;
    margin-bottom: 12px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: rgba(255, 255, 255, 0.05);
    color: var(--txt);
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  input:focus {
    outline: none;
    border-color: #667eea;
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
  }

  input:hover {
    background: rgba(255, 255, 255, 0.08);
  }

  button {
    cursor: pointer;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
  }

  button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  button:active::before {
    width: 300px;
    height: 300px;
  }

  button.submit-btn { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }

  button.submit-btn:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
  }

  button.reset-btn { 
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
    border: none;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
  }

  button.reset-btn:hover {
    background: linear-gradient(135deg, #ee5a6f 0%, #ff6b6b 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
  }

  button.today-btn { 
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--border);
    margin-top: 4px;
  }

  button.today-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
  }

  table {
    width: 100%;
    background: var(--box);
    backdrop-filter: blur(20px);
    border-collapse: collapse;
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid var(--border);
    box-shadow: 0 8px 32px var(--shadow);
    position: relative;
    z-index: 1;
  }

  th, td { 
    padding: 14px 10px;
    font-size: 0.9rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  thead { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.8rem;
  }

  tbody tr {
    transition: all 0.3s ease;
  }

  tbody tr:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: scale(1.01);
  }

  tbody tr:last-child td {
    border-bottom: none;
  }

  .positive { 
    color: #4ade80;
    font-weight: 600;
    text-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
  }

  .negative { 
    color: #f87171;
    font-weight: 600;
    text-shadow: 0 0 10px rgba(248, 113, 113, 0.3);
  }

  .highlight {
    animation: flash 1s ease-in-out;
  }

  @keyframes flash {
    0%, 100% { background-color: transparent; }
    50% { background-color: rgba(102, 126, 234, 0.2); }
  }

  hr {
    border: none;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    margin: 20px 0;
  }

  #chartBox {
    padding: 30px 20px;
  }

  @media (max-width: 480px) {
    h1 {
      font-size: 2rem;
    }
    
    form, #goalBox, #chartBox {
      padding: 18px;
      border-radius: 16px;
    }
    
    th, td {
      padding: 10px 6px;
      font-size: 0.8rem;
    }
  }
</style>

</head>

<body>
<h1>üí™ Painon seuranta</h1>

<form id="painoForm">
  <label>P√§iv√§m√§√§r√§</label>
  <input type="date" id="date" required>
  <button type="button" class="today-btn" id="todayBtn">T√§n√§√§n</button>

  <label>Paino (kg)</label>
  <input type="number" step="0.1" id="weight" required>

  <button class="submit-btn" type="submit">Lis√§√§ merkint√§</button>
  <button class="reset-btn" type="button" id="reset">Nollaa kaikki</button>
</form>

<div id="goalBox">
  <label>Tavoitepaino (kg)</label>
  <input type="number" step="0.1" id="goalInput">
  <button type="button" class="submit-btn" id="saveGoal">Tallenna tavoite</button>

  <hr>

  <label>Varmuuskopiointi</label>
  <button type="button" class="today-btn" id="exportBtn">Vie JSON</button>

  <input type="file" id="importFile" accept="application/json">
  <button type="button" class="today-btn" id="importBtn">Tuo JSON</button>
</div>

<table id="table">
  <thead>
    <tr>
      <th>Pvm</th>
      <th>Paino</th>
      <th>Ed.</th>
      <th>Alk.</th>
      <th>%</th>
      <th>Tavoite</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="chartBox"><canvas id="chart"></canvas></div>

<script>
const KEY="painodata";
const GOAL_KEY="painotavoite";
const dateI=document.getElementById("date");
const weightI=document.getElementById("weight");
const tbody=document.querySelector("#table tbody");
const resetBtn=document.getElementById("reset");
const todayBtn=document.getElementById("todayBtn");
const goalI=document.getElementById("goalInput");
const saveGoal=document.getElementById("saveGoal");

// Simuloi localStorage, koska se ei ole k√§ytett√§viss√§ artifakteissa
const storage = {};
const fakeLocalStorage = {
  getItem: (key) => storage[key] || null,
  setItem: (key, value) => { storage[key] = value; },
  removeItem: (key) => { delete storage[key]; }
};

document.addEventListener("DOMContentLoaded",()=>{
  dateI.value=new Date().toISOString().split("T")[0];
  goalI.value=fakeLocalStorage.getItem(GOAL_KEY)||"";
  render();
  initChart();
});

todayBtn.onclick=()=>{ dateI.value=new Date().toISOString().split("T")[0]; };

document.getElementById("painoForm").addEventListener("submit",e=>{
  e.preventDefault();
  const d=dateI.value;
  const w=parseFloat(weightI.value);
  if(!d||isNaN(w))return;
  const arr=JSON.parse(fakeLocalStorage.getItem(KEY)||"[]");
  const idx=arr.findIndex(x=>x.date===d);
  if(idx>=0)arr[idx].weight=w; else arr.push({date:d,weight:w});
  arr.sort((a,b)=>new Date(a.date)-new Date(b.date));
  fakeLocalStorage.setItem(KEY,JSON.stringify(arr));

  weightI.value="";
  render();
  updateChart();
  document.getElementById("table").scrollIntoView({ behavior:"smooth" });
});

resetBtn.onclick=()=>{ 
  if(confirm("Nollataanko kaikki?")){
    fakeLocalStorage.removeItem(KEY); 
    render(); 
    updateChart(); 
  }
};

saveGoal.onclick=()=>{
  const g=parseFloat(goalI.value);
  if(!isNaN(g)){
    fakeLocalStorage.setItem(GOAL_KEY,g); 
    render(); 
    updateChart();
  }
};

function fmtShort(d){
  const x=new Date(d);
  return x.getDate().toString().padStart(2,"0")+"."+
         (x.getMonth()+1).toString().padStart(2,"0")+"."+
         x.getFullYear().toString().slice(2);
}

function render(){
  const arr=JSON.parse(fakeLocalStorage.getItem(KEY)||"[]");
  const goal=parseFloat(fakeLocalStorage.getItem(GOAL_KEY));
  tbody.innerHTML="";
  if(arr.length===0){
    const r=document.createElement("tr");
    const c=document.createElement("td");
    c.colSpan=6;c.textContent="Ei merkint√∂j√§";c.style.textAlign="center";
    r.appendChild(c); tbody.appendChild(r); return;
  }
  const first=arr[0].weight;

  arr.forEach((m,i)=>{
    const r=document.createElement("tr");

    const d=document.createElement("td"); 
    d.textContent=fmtShort(m.date);
    r.appendChild(d);

    const w=document.createElement("td");
    w.textContent=m.weight.toFixed(1);
    r.appendChild(w);

    const prev=document.createElement("td");
    if(i===0)prev.textContent="-"; 
    else{
      const diff=m.weight-arr[i-1].weight;
      prev.textContent=diff.toFixed(1);
      prev.classList.add(diff>0?"positive":diff<0?"negative":"");
    }
    r.appendChild(prev);

    const f=document.createElement("td");
    if(i===0)f.textContent="-"; 
    else{
      const diff=m.weight-first;
      f.textContent=diff.toFixed(1);
      f.classList.add(diff>0?"positive":diff<0?"negative":"");
    }
    r.appendChild(f);

    const pct=document.createElement("td");
    if(i===0)pct.textContent="-"; 
    else{
      const p=((m.weight-first)/first)*100;
      pct.textContent=p.toFixed(1)+"%";
      pct.classList.add(p>0?"positive":p<0?"negative":"");
    }
    r.appendChild(pct);

    const goalC=document.createElement("td");
    if(isNaN(goal)) goalC.textContent="-";
    else{
      const diff=m.weight-goal;
      goalC.textContent=diff.toFixed(1);
      goalC.classList.add(diff>0?"positive":diff<0?"negative":"");
    }
    r.appendChild(goalC);

    r.classList.add("highlight");

    tbody.appendChild(r);
  });
}

let chartObj;
function initChart(){
  const ctx=document.getElementById("chart").getContext("2d");
  chartObj=new Chart(ctx,{
    type:"line",
    data:{labels:[],datasets:[
      {
        label:"Paino (kg)",
        data:[],
        borderColor:"#667eea",
        backgroundColor:"rgba(102, 126, 234, 0.2)",
        fill:true,
        tension:0.4,
        borderWidth: 3,
        pointRadius: 5,
        pointHoverRadius: 7,
        pointBackgroundColor: "#667eea",
        pointBorderColor: "#fff",
        pointBorderWidth: 2
      },
      {
        label:"Tavoite",
        data:[],
        borderColor:"#f093fb",
        borderDash:[8,4],
        pointRadius:0,
        borderWidth: 2
      }
    ]},
    options:{
      animation:{ duration:1000, easing:"easeOutQuart" },
      responsive:true,
      maintainAspectRatio: true,
      scales:{
        x:{
          ticks:{color:"rgba(255,255,255,0.8)", font: {size: 11}},
          grid:{color:"rgba(255,255,255,0.05)"}
        },
        y:{
          ticks:{color:"rgba(255,255,255,0.8)", font: {size: 11}},
          grid:{color:"rgba(255,255,255,0.05)"}
        }
      },
      plugins:{
        legend:{
          labels:{color:"#fff", font: {size: 13, weight: '600'}},
          position: 'top'
        }
      }
    }
  });
  updateChart();
}

function updateChart(){
  const arr=JSON.parse(fakeLocalStorage.getItem(KEY)||"[]");
  const goal=parseFloat(fakeLocalStorage.getItem(GOAL_KEY));
  chartObj.data.labels=arr.map(x=>fmtShort(x.date));
  chartObj.data.datasets[0].data=arr.map(x=>x.weight);
  chartObj.data.datasets[1].data=isNaN(goal)?arr.map(()=>null):arr.map(()=>goal);
  chartObj.update();
}

// JSON Vienti
document.getElementById("exportBtn").onclick = () => {
  const data = {
    entries: JSON.parse(fakeLocalStorage.getItem(KEY) || "[]"),
    goal: fakeLocalStorage.getItem(GOAL_KEY) || null
  };

  const blob = new Blob([JSON.stringify(data, null, 2)], {
    type: "application/json"
  });

  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "painonseuranta_backup.json";
  a.click();
  URL.revokeObjectURL(url);
};

// JSON Tuonti
document.getElementById("importBtn").onclick = () => {
  const fileInput = document.getElementById("importFile");
  if (!fileInput.files.length) {
    alert("Valitse JSON-tiedosto ensin.");
    return;
  }

  const file = fileInput.files[0];
  const reader = new FileReader();

  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      if (!data.entries) {
        alert("Virheellinen tiedosto.");
        return;
      }

      fakeLocalStorage.setItem(KEY, JSON.stringify(data.entries));
      if (data.goal !== undefined && data.goal !== null) {
        fakeLocalStorage.setItem(GOAL_KEY, data.goal);
      }

      alert("Tiedot tuotu onnistuneesti.");
      render();
      updateChart();

    } catch (err) {
      alert("JSON-luku ep√§onnistui.");
    }
  };

  reader.readAsText(file);
};
</script>

</body>
</html>
